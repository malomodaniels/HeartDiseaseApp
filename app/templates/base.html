<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title or "IIH Web" }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
  :root{
    --accent:#dc3545;   /* same red style */
    --muted:#f8f9fa;
    --ink:#111827;
  }

  body{
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color: var(--ink);
    background: #f6f7fb;
  }

  /* HERO */
  .hero{
    min-height: 70vh;
    border-radius: 18px;
    overflow: hidden;
    position: relative;
    display: flex;
    align-items: center;
    box-shadow: 0 18px 50px rgba(17,24,39,.08);
  }
  .hero::before{
    content:"";
    position:absolute; inset:0;
    background:
      linear-gradient(110deg, rgba(0,0,0,.65), rgba(0,0,0,.25)),
      url("{{ url_for('static', filename='images/hero-hospital.jpg') }}");
    background-size: cover;
    background-position: center;
    transform: scale(1.02);
  }
  .hero > .hero-inner{
    position: relative;
    padding: 56px 26px;
    color: #fff;
    width: 100%;
  }
  .hero h1{
    font-weight: 800;
    letter-spacing: -0.5px;
  }
  .hero .lead{
    opacity: .95;
    max-width: 680px;
  }

  /* Cards */
  .card-soft{
    border: 1px solid rgba(0,0,0,.06);
    border-radius: 14px;
    box-shadow: 0 12px 26px rgba(17,24,39,.06);
  }
  .card-soft:hover{
    transform: translateY(-3px);
    transition: .2s ease;
    box-shadow: 0 18px 40px rgba(17,24,39,.10);
  }

  /* Buttons */
  .btn-accent{ background: var(--accent); border-color: var(--accent); }
  .btn-accent:hover{ filter: brightness(.95); }
  .btn-outline-accent{ border-color: var(--accent); color: var(--accent); }
  .btn-outline-accent:hover{ background: var(--accent); color:#fff; }

  .sens-hero {
  background: linear-gradient(
    135deg,
    rgba(220, 53, 69, 0.06),
    rgba(13, 110, 253, 0.04)
  );
  border-radius: 14px;
  padding: 2.5rem 1.5rem;
}

.sens-hero h1 {
  letter-spacing: -0.5px;
}

.sens-hero .badge {
  font-weight: 500;
  padding: 0.45em 0.7em;
}
</style>

</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('core.index') }}">IIH Web</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="nav" class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('prediction.landing') }}">Prediction</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('sensitization.index') }}">Sensitization</a></li>
        {% if current_user.is_authenticated and current_user.role == 'patient' %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('appointments.list_my') }}">My Appointments</a></li>
        {% endif %}
        {% if current_user.is_authenticated and current_user.role in ['admin','clinician','public_health'] %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>
        {% endif %}
      </ul>
      <ul class="navbar-nav">
        {% if current_user.is_authenticated %}
          <li class="nav-item"><span class="navbar-text me-2">{{ current_user.full_name }} ({{ current_user.role }})</span></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a></li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.login') }}">Login</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('auth.register') }}">Register</a></li>
        {% endif %}
      </ul>
    </div>
  </div>
</nav>

<main class="container container-app py-4">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat, msg in messages %}
        <div class="alert alert-{{cat}}">{{ msg }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  {% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  async function openModal(url, title="IIH") {
    const modalEl = document.getElementById("appModal");
    const titleEl = document.getElementById("appModalTitle");
    const bodyEl  = document.getElementById("appModalBody");

    titleEl.textContent = title;
    bodyEl.innerHTML = `<div class="text-center p-4">Loading…</div>`;

    const res = await fetch(url, { headers: { "X-Modal": "1" } });
    const html = await res.text();
    bodyEl.innerHTML = html;

    const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
    modal.show();

    // bind any forms inside the modal for AJAX submit
    bindModalForms();
  }

  function bindModalLinks() {
    document.querySelectorAll("[data-modal]").forEach(a => {
      a.addEventListener("click", (e) => {
        e.preventDefault();
        openModal(a.getAttribute("href"), a.getAttribute("data-modal-title") || "IIH");
      });
    });
  }

  async function submitModalForm(form) {
    const bodyEl = document.getElementById("appModalBody");
    const formData = new FormData(form);

    const res = await fetch(form.action, {
      method: form.method || "POST",
      body: formData,
      headers: { "X-Modal": "1" }
    });

    const html = await res.text();
    bodyEl.innerHTML = html;

    // Re-bind after content replaced
    bindModalForms();
    bindModalLinks();
  }

  function bindModalForms() {
    document.querySelectorAll("#appModalBody form[data-ajax='1']").forEach(f => {
      f.addEventListener("submit", (e) => {
        e.preventDefault();
        submitModalForm(f);
      });
    });
  }

  // initial bind for page links
  document.addEventListener("DOMContentLoaded", () => {
    bindModalLinks();
  });
</script>

<!-- Global App Modal -->
<div class="modal fade" id="appModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="appModalTitle">IIH</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="appModalBody">
        <div class="text-center p-4">Loading…</div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
